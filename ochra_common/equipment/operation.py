from pydantic import Field
from ..base import DataModel
import uuid
from enum import Enum
from datetime import datetime
from typing import List, Dict, Any
from .operation_result import OperationResult


class Operation(DataModel):
    """
    Abstract operation class to be generated by the system
    whenever an agent/device performs an action.

    Attributes:
        caller_id (uuid.UUID): The unique identifier of the caller.
        method (str): The method name that was called.
        args (Dict[str, Any]): A dictionary of arguments passed to the method.
        status (Enum): The current status of the operation.
        start_timestamp (datetime): The timestamp when the operation started.
        end_timestamp (datetime): The timestamp when the operation ended.
        result (List[OperationResult]): A list of results from the operation.
    """
    caller_id: uuid.UUID
    method: str
    args: Dict[str, Any]
    status: Enum = -1  # TODO: Define OperationStatus Enum
    start_timestamp: datetime = Field(default=None)
    end_timestamp: datetime = Field(default=None)
    result: str = Field(default="") #TODO for later List[OperationResult] = Field(default_factory=list)

    def add_start_timestamp(self, timestamp: datetime):
        """
        Add a start timestamp to the operation.

        Args:
            timestamp (datetime): The timestamp when the operation started.
        """
        raise NotImplementedError

    def add_end_timestamp(self, timestamp: datetime):
        """
        Add an end timestamp to the operation.

        Args:
            timestamp (datetime): The timestamp when the operation ended.
        """
        raise NotImplementedError

    def add_result(self, result: OperationResult):
        """
        Add a result to the operation.

        Args:
            result (OperationResult): The result of the operation.
        """
        raise NotImplementedError
